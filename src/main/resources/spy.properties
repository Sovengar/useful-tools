# ═══════════════════════════════════════════════════════════════════════════════
# P6SPY CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
# P6Spy is a framework that enables database data to be seamlessly intercepted
# and logged with no code changes to the application.
#
# This file configures how SQL queries are logged.
# Dependency: p6spy:p6spy (pom.xml)
#
# P6Spy is enabled automatically in dev and test profiles via:
#   spring.datasource.driver-class-name=com.p6spy.engine.spy.P6SpyDriver
#
# For production, remove or comment out the driver configuration to disable logging.
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────────
# APPENDER CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────────
# Available appenders:
#   - com.p6spy.engine.spy.appender.Slf4JLogger (integrates with Spring Boot logging)
#   - com.p6spy.engine.spy.appender.StdoutLogger (outputs to System.out)
#   - com.p6spy.engine.spy.appender.FileLogger (outputs to spy.log file)
appender=com.p6spy.engine.spy.appender.Slf4JLogger

# ─────────────────────────────────────────────────────────────────────────────────
# LOG FORMAT
# ─────────────────────────────────────────────────────────────────────────────────
# Available placeholders:
#   %(currentTime)     - Current timestamp
#   %(executionTime)   - Query execution time in milliseconds
#   %(category)        - Category (statement, commit, rollback, result, batch)
#   %(effectiveSql)    - SQL with parameter values substituted
#   %(sql)             - Raw SQL with ? placeholders
#   %(sqlSingleLine)   - SQL with newlines removed
#   %(connectionId)    - Connection ID
logMessageFormat=com.p6spy.engine.spy.appender.CustomLineFormat
customLogMessageFormat=P6SPY | %(executionTime)ms | %(category) | %(effectiveSql)

# ─────────────────────────────────────────────────────────────────────────────────
# EXECUTION THRESHOLD
# ─────────────────────────────────────────────────────────────────────────────────
# Log only statements that take longer than this value (in milliseconds)
# Set to 0 to log all queries
# Set to a higher value (e.g., 100) to only log slow queries
executionThreshold=0

# ─────────────────────────────────────────────────────────────────────────────────
# CATEGORY FILTERING
# ─────────────────────────────────────────────────────────────────────────────────
# Exclude certain categories from logging:
#   - info: informational messages
#   - debug: debug messages
#   - result: result set data
#   - resultset: result set metadata
#   - batch: batch statements
#   - statement: individual statements
#   - commit: commit operations
#   - rollback: rollback operations
excludecategories=info,debug,result,resultset,batch

# ─────────────────────────────────────────────────────────────────────────────────
# DATE FORMAT
# ─────────────────────────────────────────────────────────────────────────────────
dateformat=yyyy-MM-dd HH:mm:ss

# ─────────────────────────────────────────────────────────────────────────────────
# STACK TRACE
# ─────────────────────────────────────────────────────────────────────────────────
# Set to true to include stack traces in logs (useful for finding where queries originate)
stacktrace=false

# ─────────────────────────────────────────────────────────────────────────────────
# SQL FILTERING (REGEX)
# ─────────────────────────────────────────────────────────────────────────────────
# Uncomment to filter out specific SQL patterns
# filter=true
# sqlexpression=^select 1$

# ─────────────────────────────────────────────────────────────────────────────────
# DRIVER DETECTION
# ─────────────────────────────────────────────────────────────────────────────────
# Auto-flush logs
autoflush=true

# Deregister drivers to let P6Spy auto-detect the underlying driver
# This makes P6Spy compatible with Testcontainers and dynamic datasources
deregisterdrivers=true
